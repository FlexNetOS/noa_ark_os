# Storage Layer

The storage layer keeps persistent artefacts generated by workflow automation,
manual operators, and system services. Instrumentation ensures that every
append-only ledger under `.workspace/indexes/` is mirrored into this tree so
offline verifiers can audit evidence without touching ephemeral workspace data.

## Instrumentation Mirrors

| Path | Source | Description |
| --- | --- | --- |
| `storage/db/` | `.workspace/indexes/` | Immutable pipeline logs written by `PipelineInstrumentation`. Each `*.log` file is a line-delimited JSON stream of signed entries mirrored from the live workspace. |
| `storage/db/analytics/goal_kpis.json` | `.workspace/indexes/goal_kpis.json` | Consolidated goal metrics surfaced on the self-status endpoint. |
| `storage/db/evidence/ledger.jsonl` | `.workspace/indexes/evidence/ledger.jsonl` | Evidence ledger capturing Merkle receipts, security scans, and task dispatch reports. |
| `storage/db/auto_fix/` | `.workspace/indexes/auto_fix/` | Auto-fix snapshots storing plans and policy decisions emitted by repair agents. |
| `storage/db/budget_guardian/` | `.workspace/indexes/budget_guardian/` | Budget guardian manifests that record token and latency enforcement decisions. |
| `storage/db/pipelines/` | `.workspace/indexes/` | Documentation for the mirrored pipeline logs (`relocation.log`, `document_log`, `stage_receipt.log`, etc.). |

The mirror is append-only. Instrumentation updates both sides atomically so
signatures and hash chains remain consistent across the workspace and archival
views.

## Supporting Directories

- `storage/analytics/` – cached aggregates derived from instrumentation outputs.
- `storage/artifacts/` – build outputs preserved for offline replay.
- `storage/self_repair/` – scheduler plans and checkpoints for self-healing
  routines.
- `storage/telemetry/` – gateway metrics and inference telemetry exported for
  dashboards.
- `storage/snapshots/` – archived workspace snapshots captured before automated
  repairs or upgrades.

## Data Persistence Guarantees

All data is stored locally with no cloud dependencies. Instrumented folders are
safe to read directly but should only be mutated through the automation APIs so
that signatures, hashes, and audit trails remain valid.
